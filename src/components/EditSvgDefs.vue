<template>
<svg ref = "htmsvg_container_ref" 
    class = "svg_container"
>

<!--
  <svg ref="svg_ref" class="svg_defs"
     width="728.504pt"
     height="1031.81pt"
     viewBox="0 0 728.504 1031.81"
     version="1.1"
     id="svg6699"
     sodipodi:docname="exam01.svg"
     inkscape:version="1.2.2 (732a01da63, 2022-12-09)"
     xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
     xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:svg="http://www.w3.org/2000/svg"
  >
    <sodipodi:namedview
       id="namedview6701"
       pagecolor="#ffffff"
       bordercolor="#000000"
       borderopacity="0.25"
       inkscape:showpageshadow="2"
       inkscape:pageopacity="0.0"
       inkscape:pagecheckerboard="0"
       inkscape:deskcolor="#d1d1d1"
       inkscape:document-units="pt"
       showgrid="false"
       inkscape:zoom="2.5"
       inkscape:cx="408"
       inkscape:cy="278"
       inkscape:window-width="3260"
       inkscape:window-height="1830"
       inkscape:window-x="398"
       inkscape:window-y="30"
       inkscape:window-maximized="0"
       inkscape:current-layer="svg6699" />
    <defs
       id="defs2271">
      <g
         id="g2269">
        <g
           id="glyph-0-0" />
        <g
           id="glyph-0-1">
          <path
             d="M 0.546875 -3.234375 C 0.6875 -3.109375 0.8125 -2.953125 0.9375 -2.75 C 1.046875 -2.5625 1.09375 -2.328125 1.265625 -2.328125 C 1.359375 -2.328125 1.4375 -2.421875 1.4375 -2.546875 C 1.4375 -2.90625 0.78125 -3.21875 0.578125 -3.265625 C 0.5625 -3.265625 0.5625 -3.25 0.546875 -3.234375 Z M 0.5625 -0.890625 C 0.578125 -0.859375 0.609375 -0.828125 0.65625 -0.828125 C 0.65625 -0.828125 0.671875 -0.828125 0.6875 -0.828125 C 0.734375 -0.859375 0.703125 -0.9375 0.78125 -0.984375 L 1.71875 -1.703125 L 1.703125 -1.75 C 1.46875 -1.65625 0.625 -1.28125 0.328125 -1.265625 Z M 2.0625 -3.59375 C 2.0625 -3.6875 2.234375 -3.734375 2.234375 -3.8125 C 2.234375 -3.859375 2.21875 -3.875 2.171875 -3.890625 L 1.734375 -4.015625 C 1.765625 -3.890625 1.796875 -3.6875 1.796875 -3.5625 L 1.796875 -1.5625 C 1.796875 -1.3125 1.46875 -0.046875 0.296875 0.34375 C 0.296875 0.359375 0.3125 0.375 0.3125 0.390625 C 0.953125 0.296875 2.0625 -0.265625 2.0625 -1.75 Z M 4.421875 -0.4375 C 4.359375 -0.21875 4.296875 0.03125 3.90625 0.03125 L 3.3125 0.03125 C 2.9375 0.03125 2.90625 -0.03125 2.90625 -0.359375 L 2.90625 -3.578125 C 2.90625 -3.703125 3.09375 -3.75 3.09375 -3.8125 C 3.09375 -3.84375 3.0625 -3.890625 3.015625 -3.890625 L 2.578125 -4 C 2.59375 -3.921875 2.640625 -3.75 2.640625 -3.578125 L 2.640625 -0.21875 C 2.640625 0.234375 2.71875 0.296875 3.21875 0.296875 L 4.125 0.296875 C 4.328125 0.296875 4.765625 0.21875 4.765625 -0.03125 C 4.765625 -0.140625 4.625 -0.09375 4.609375 -0.3125 L 4.5625 -0.875 L 4.53125 -0.875 Z M 3.1875 -1.828125 C 3.296875 -1.765625 3.5625 -1.59375 3.75 -1.390625 C 3.921875 -1.203125 4 -1 4.1875 -1 C 4.265625 -1 4.328125 -1.078125 4.328125 -1.21875 C 4.328125 -1.609375 3.3125 -1.84375 3.203125 -1.859375 Z M 3.96875 -3.515625 C 3.890625 -3.296875 3.28125 -2.609375 3.109375 -2.453125 L 3.125 -2.421875 C 3.421875 -2.53125 4.0625 -3.015625 4.125 -3.0625 C 4.140625 -3.078125 4.171875 -3.078125 4.203125 -3.078125 C 4.34375 -3.078125 4.390625 -3.078125 4.390625 -3.140625 C 4.390625 -3.171875 4.375 -3.1875 4.34375 -3.21875 Z M 3.96875 -3.515625 "
             id="path3" />
        </g>
      </g>
    </defs>

    <path
       fill="none"
       stroke-width="0.45"
       stroke-linecap="butt"
       stroke-linejoin="miter"
       stroke="rgb(13.725281%, 9.803772%, 8.627319%)"
       stroke-opacity="1"
       stroke-miterlimit="4"
       d="M -0.0000125 -0.00055 L 201.453113 0.00335625 "
       transform="matrix(1, 0, 0, -1, 437.4297, 220.2807)"
       id="path2273" />
    <text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:8px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;stroke-width:0.75"
       x="618.60004"
       y="148.79999"
       id="text7838"><tspan
         sodipodi:role="line"
         id="tspan7836"
         style="stroke-width:0.75;-inkscape-font-specification:'sans-serif, Normal';font-family:sans-serif;font-weight:normal;font-style:normal;font-stretch:normal;font-variant:normal;font-size:8px;font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal"
         x="618.60004"
         y="148.79999">da</tspan>
    </text>
  </svg>
-->

</svg>
</template>


<script setup lang="ts">
import {
  ref,
  // reactive,
  // computed,
  // inject, 
  watch,
  onBeforeUpdate,
  onMounted,
  // onBeforeUnmount,
  nextTick
} from "vue";

// import {
//   useDraggable,
//   useElementBounding,
//   useEventListener,
//   useMouse, useMousePressed, onKeyStroke, useMagicKeys, useMouseInElement, useParentElement, useElementSize, useActiveElement,
//   whenever
// } from '@vueuse/core'

// import { v4 as uuidv4 } from "uuid";

//= 「const svg_ref = ref(null);」の代り、親 component からアクセス出来る defineModel を定義する 
const svg_ref               = defineModel<any>("svg_ref",              { local: true, default: null }); // DOM,                   name svg_ref 使用,              parent: v-model:svg_ref="svg_dom"
const htmsvg_container_ref  = defineModel<any>("htmsvg_container_ref", { local: true, default: null }); // DOM,                   ame htmsvg_container_ref 使用,  parent: v-model:htmsvg_container_ref="svg_container_dom"
const svg_content_ref       = defineModel<any>("svg_content_ref",      { local: true, default: ""   }); // SVG テキストコンテンツ,  name svg_content_ref 使用,      parent: v-model:svg_content_ref="null"


watch(svg_content_ref, (val, oldVal) => {
  // console.log("svg_content_ref changed: ", val, oldVal);
  htmsvg_container_ref.value.innerHTML = val;
});



//= vue 3.4.4 htmsvg_container_ref.value is null 対策 2024.01.03a
//  【現象】yarn upgrade vue
//           ⇒vue 3.4.4 htmsvg_container_ref.value is null
//  問題の原因を特定するための別のアプローチとして、onMountedフックが実行されるタイミングを調整することが考えられます。
//  具体的には、nextTick関数を使用して、DOMが更新された後にonMountedフック内のコードが実行されるようにする。
//=
onMounted(async () => {
  await nextTick();

  console.log("onMounted set innerHTML ← svg_content_ref.value");
  // console.log("htmsvg_container_ref.value: ", htmsvg_container_ref.value)

  htmsvg_container_ref.value.innerHTML = svg_content_ref.value;

  // console.log((htmsvg_container_ref.value as any).innerHTML);
});

</script>



<style scoped>

.svg_defs {
  /* display: none; */
}

.svg_events {
    pointer-events: all;
}

.client_decided {
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    margin: 0px;
    padding: 0px;
}

.svg_container {
}


</style>
